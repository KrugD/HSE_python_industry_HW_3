# HSE Python Industry HW 3

Этот проект представляет собой API для сокращения ссылок, написанный на **FastAPI**. Он позволяет создавать короткие ссылки, управлять ими, а также предоставляет статистику по их использованию.

---

## 📌 Описание API

### 🔹 Основные возможности:
1. **Создание короткой ссылки**:
   - ✅ Доступно всем пользователям.
   - 🔐 Если пользователь авторизован, ссылка будет привязана к его аккаунту.

2. **Изменение короткой ссылки**:
   - 🔒 Доступно только владельцам ссылок.

3. **Перенаправление по короткой ссылке**:
   - 🌍 Доступно всем пользователям.

4. **Поиск ссылок по оригинальному URL**:
   - 🔎 Доступно всем пользователям.

5. **Удаление ссылок**:
   - ❌ Доступно только владельцам ссылок.
   - 🛑 Администраторы могут удалять все ссылки.

6. **Статистика по ссылкам**:
   - 📊 Показывает количество переходов, дату создания и последнего использования.

7. **Регистрация и аутентификация пользователей**:
   - 🔑 Пользователи могут регистрироваться и входить в систему с помощью **JWT токенов**.

---

## 📌 Примеры запросов

### 📝 1. Создание короткой ссылки
```http
POST /shorten
Content-Type: application/json

{
  "original_url": "https://example.com",
  "short_code": "example",
  "expires_at": "2026-03-31T23:59:59"
}
```
📌 **Ответ**:
```json
{
  "short_code": "example",
  "original_url": "https://example.com",
  "expires_at": "2026-03-31T23:59:59",
  "created_at": "2025-03-15T12:11:41",
  "user_id": 1
}
```

### 🔗 2. Перенаправление по короткой ссылке
```http
GET /example/redirect
```
📌 **Ответ**:
```json
{
  "url": "https://example.com"
}
```

### 📊 3. Получение статистики по ссылке
```http
GET /example/stats
```
📌 **Ответ**:
```json
{
  "hits": 10,
  "created_at": "2025-03-15T12:00:00",
  "last_used": "2025-03-15T16:31:02"
}
```

### 👤 4. Регистрация пользователя
```http
POST /register
Content-Type: application/json

{
  "username": "user1",
  "email": "user1@example.com",
  "password": "password123"
}
```
📌 **Ответ**:
```json
{
  "username": "user1",
  "email": "user1@example.com",
  "role": "user"
}
```

### 🔑 5. Аутентификация пользователя
```http
POST /login
Content-Type: application/json

{
  "username": "user1",
  "password": "password123"
}
```
📌 **Ответ**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

---

## 📌 Инструкция по запуску

### 🚀 1. Установка зависимостей
Убедитесь, что у вас установлены **Docker** и **Docker Compose**. Затем выполните:
```bash
docker-compose up --build
```

### ▶️ 2. Запуск приложения
После сборки контейнеров приложение будет доступно по адресу:
```
http://localhost:8000
```

### 📜 3. Документация API
- **Swagger UI**: [http://localhost:8000/docs](http://localhost:8000/docs)
- **ReDoc**: [http://localhost:8000/redoc](http://localhost:8000/redoc)

---

## 📌 Описание базы данных

### 📂 Таблицы:

#### 🧑‍💻 **Пользователи (users):**
- `id`: Уникальный идентификатор пользователя.
- `username`: Имя пользователя.
- `email`: Электронная почта пользователя.
- `hashed_password`: Хешированный пароль.
- `role`: Роль пользователя (например, `user` или `admin`).

#### 🔗 **Ссылки (links):**
- `id`: Уникальный идентификатор ссылки.
- `short_code`: Короткий код ссылки.
- `original_url`: Оригинальный URL.
- `expires_at`: Дата истечения срока действия ссылки.
- `created_at`: Дата создания ссылки.
- `hits`: Количество переходов по ссылке.
- `last_used`: Дата последнего использования ссылки.
- `user_id`: Идентификатор пользователя, создавшего ссылку.

---

## 📌 Структура проекта
```
.
├── app
│   ├── auth.py              # 🔑 Аутентификация и авторизация
│   ├── cache.py             # 💾 Кэширование ссылок
│   ├── config.py            # ⚙️ Настройки приложения
│   ├── crud.py              # 🗄️ Операции с базой данных
│   ├── database.py          # 🛢️ Подключение к базе данных
│   ├── main.py              # 🚀 Основной файл приложения
│   ├── models.py            # 📦 Модели базы данных
│   ├── routers              # 📌 Роутеры API
│   │   ├── auth_users.py    # 👤 Роутер для аутентификации
│   │   ├── links.py         # 🔗 Роутер для работы с ссылками
│   │   └── stats.py         # 📊 Роутер для статистики
│   ├── schemas.py           # 📜 Схемы данных (Pydantic)
│   └── utils.py             # 🛠️ Вспомогательные функции
├── docker-compose.yml       # 🐳 Конфигурация Docker Compose
├── Dockerfile               # 📦 Dockerfile для сборки образа
├── requirements.txt         # 📌 Зависимости Python
└── README.md                # 📖 Этот файл
```


